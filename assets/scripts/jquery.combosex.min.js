(function(c){jQuery.fn.combosex=function(v){n=c("body");m.undelegate(".combosex");var t={cntxt:this,args:arguments,browser:jQuery.browser,defaults:{fadeSpeed:0,scrollWidth:false,strict:true,append:true,options:false,tags:false,tagsDel:",",appendCheck:false,classCombo:false,classOptions:false,showOnFocus:true,placeholder:"",numeric:false,delay:0,lang:{noResults:"No results match"}}};var B=function(Q,R,S,P){if(arguments.length==3&&typeof S!="boolean"){P=S;S=false}var T;return function(){var U=arguments;P=P||this;S&&!T&&Q.apply(P,U);clearTimeout(T);T=setTimeout(function(){!S&&Q.apply(P,U);T=null},R)}};var I=function(){var Q=c('<div class="combosex_testscroll_outer" style="width:200px;height:200px;overflow:auto;visibility:hidden;position:absolute;z-index:-10000;top:-10000px;left:-10000px;"><div class="combosex_testscroll_inner" style="width:100px;height:300px;"></div></div>'),P=c('<div class="combosex_testscroll_auto" style="height:20px;"></div>');Q.prepend(P);n.append(Q);var R=200-P.innerWidth();Q.remove();return R};Combosex=function(V,T,S){if(typeof T=="string"){if(V.data("csuid")){var P=V.data("csuid");if(p[P]){if(p[P].API[T]){var R=[];for(var U=1;U<S.length;U++){R.push(S[U])}p[P].API[T].apply(p[P],R)}}}return false}var Q=this;Q.$obj=V;Q.attach=function(){if(Q.$obj.hasClass("combosexed")){return false}Q.$obj.addClass("combosexed");Q.options=c.extend(t.defaults,T);Q.extra={input:true,readonly:false,disabled:false,multiple:false,append:false,readonly:false};k++;Q.uid=k;if(Q.options.scrollWidth){Q.scrollWidth=Q.options.scrollWidth}else{Q.scrollWidth=I()}Q.$combospan=c('<span class="combosex_main"></span>');Q.$combospan.data("csuid",Q.uid);if(Q.options.classCombo){Q.$combospan.addClass(Q.options.classCombo)}Q.extra.readonly=Q.$obj.prop("readonly");Q.extra.disabled=Q.$obj.prop("disabled");if(!Q.data){if(Q.options.options){Q.data={hash:y(Q.options.options)}}else{Q.data={hash:J(Q.$obj)}}}Q.tagName=V.prop("tagName").toLowerCase();if(Q.tagName=="select"){Q.extra.type="select";Q.extra.input=false;Q.extra.multiple=Q.$obj.prop("multiple");Q.firstactive=Q.$obj.find("option:selected:first")}if(Q.options.tags){Q.extra.tags=true;if(Q.tagName=="input"){Q.pval=Q.$obj.val();var ai=c('<select multiple="multiple"></select>');if(Q.$obj.attr("id")){ai.attr("id",Q.$obj.attr("id"))}if(Q.$obj.attr("name")){ai.attr("name",Q.$obj.attr("name"))}if(Q.$obj.attr("class")){ai.attr("class",Q.$obj.attr("class"))}Q.$obj.replaceWith(ai);Q.$obj=ai}else{if(Q.tagName=="select"){Q.$obj.attr("multiple","multiple")}}}if(Q.extra.type=="select"||Q.options.tags){Q.extra.append=false;if(Q.options.append){Q.extra.append=true}}if(Q.tagName=="input"){Q.extra.type="input";Q.extra.input=true;Q.extra.append=true;if(!Q.options.append){Q.extra.append=false}var X="";for(var W in Q.data.hash){X+='<option value="'+Q.data.hash[W].val+'">'+Q.data.hash[W].text+"</option>"}if(Q.options.tags){Q.$obj.html(X);if(Q.pval){var ad=Q.pval.split(Q.options.tagsDel);var ac=[];for(var aa in ad){var Z=c.trim(ad[aa]);ac.push(Z);var ag=c('option[value="'+Z+'"]',Q.$obj);if(!ag.length){ag=c('<option value="'+Z+'">'+Z+"</option>");Q.$obj.append(ag)}ag.attr("selected","selected")}Q.$obj.val(ac);Q.val=ac}}}if(Q.extra.readonly){Q.$combospan.addClass("combosex_readonly")}if(Q.extra.disabled){Q.$combospan.addClass("combosex_disabled")}Q.$obj.hide();var Y=Q.$obj.width();Q.val=Q.$obj.val();if(Q.$obj.attr("placeholder")&&Q.options.placeholder==""){Q.options.placeholder=Q.$obj.attr("placeholder")}Q.$inp=c('<input autocomplete="off"  type="text" class="combosex_input combosex_input_'+Q.uid+'" value="" />');Q.$val=c('<input type="hidden" class="combosex_value" />').val(Q.val);Q.$def=c('<input type="hidden" class="combosex_def" />').val(Q.val);Q.$apndr=c('<a rel="'+Q.uid+'" class="combosex_append">+</a>');Q.$ph=c('<span class="combosex_ph" style="display:none">'+Q.options.placeholder+"</span>");Q.$spinner=c('<span class="combosex_spinner"></span>');Q.$inp.data("csuid",Q.uid);if(Q.options.type){Q.extra.type=Q.options.type}if(Q.options.multiple){Q.extra.multiple=true;Q.$obj.attr("multiple","multiple")}if(Q.options.input==true){Q.extra.input=true}if(Q.extra.append){Q.$combospan.addClass("combosex_with_append")}if(Q.options.tags){Q.extra.multiple=false;Q.extra.type="input";Q.$tags=c('<span class="combosex_tags"></span>');Q.tagsRender(Q.val);Q.$combospan.addClass("combosex_tagged").prepend(Q.$tags);Q.$tags.wrap('<span class="combosex_tags_wrap"></span>');Q.$tags.after('<span class="combosex_clear"></span>')}if(Q.extra.type=="input"){if(Q.options.tags){}else{Q.$combospan.addClass("combosex_text");Q.$combospan.append('<span class="combosex_input_span"></span>');c(".combosex_input_span",Q.$combospan).append(Q.$ph,Q.$inp);if(Q.extra.append){c(".combosex_input_span",Q.$combospan).append(Q.$apndr)}Q.$inp.val(Q.val);if(Q.val&&Q.val!=""){Q.$ph.hide()}else{Q.$ph.show()}}}Q.$obj.after(Q.$combospan);if(Q.extra.type=="select"){Q.$combospan.addClass("combosex_select");if(Q.extra.multiple){Q.$combospan.addClass("combosex_multi_select");var af=F(Q,Q.data.hash);Q.$list_multi=c('<div class="combosex_list_multi  combosex_listwrap_'+Q.uid+'"><div class="combosex_options combosex_options_'+Q.uid+'">'+af+"</div></div>");if(Q.options.classOptions){Q.$list_multi.addClass(Q.options.classOptions)}c(".combosex_options_active:first");if(c(".combosex_options_active",Q.$list_multi).length){Q.lastoptionclicked=c(".combosex_options_active:first");Q.startshift=Q.lastoptionclicked}Q.$combospan.append(Q.$list_multi);var ae=0;if(Q.extra.input){Q.$list_multi.prepend('<div class="combosex_search"><div></div></div><div class="combosex_search_nofound" style="display:none;"><em>'+Q.options.lang.noResults+"</em></div>");Q.$inp.val("");Q.$ph.show();c(".combosex_search div",Q.$list_multi).append(Q.$ph,Q.$inp);if(Q.extra.append){c(".combosex_search div",Q.$list_multi).append(Q.$apndr)}}Q.$list_multi.delegate(".combosex_options a","mousedown.combosex",function(){Q.$inp.trigger("focus.combosex");c(".combosex_main").removeClass("combosex_active");Q.$combospan.addClass("combosex_active");var am=c(this);Q.lastoptionclicked=am;if(e){am.toggleClass("combosex_options_active");Q.startshift=am}else{if(h){if(Q.startshift){c("a",Q.$list_multi).removeClass("combosex_options_active");var al=Q.startshift.index(".combosex_options_"+Q.uid+" a:visible");var ak=am.index(".combosex_options_"+Q.uid+" a:visible");var aj=al;var an=ak;if(al>ak){aj=ak;an=al}c(".combosex_options_"+Q.uid+" a:visible").slice(aj,an).addClass("combosex_options_active");am.addClass("combosex_options_active");Q.startshift.addClass("combosex_options_active")}else{am.addClass("combosex_options_active");Q.startshift=am}}else{c("a",Q.$list_multi).removeClass("combosex_options_active");am.toggleClass("combosex_options_active");am.addClass("combosex_options_active");Q.startshift=am}}Q.change_multi_values();Q.lastoptionclicked=am});Q.$list_multi.bind("focus.combosex",function(){Q.multi_focus=true;g=Q.uid;o=Q.uid});Q.$list_multi.bind("blur.combosex",function(){if(o!=g){return false}Q.$combospan.removeClass("combosex_active");Q.multi_focus=false;var am=0;c(".combosex_search_nofound").hide();Q.$inp.val("");if(Q.extra.input&&Q.extra.multiple){var ar=c(".combosex_options ul",Q.$list_multi).height();c(".combosex_options",Q.$list_multi).html(F(Q,Q.data.hash));g=false;Q.$ph.show();if(Q.val){var ap=Q.val;var ao="";for(var al in ap){ao+='a[rel="'+ap[al]+'"],'}c(".combosex_options a",Q.$list_multi).removeClass("combosex_options_active");c(ao,c(".combosex_options",Q.$list_multi)).addClass("combosex_options_active")}var aj=c(".combosex_options ul",Q.$list_multi).height();if(ar!=aj){am=c(".combosex_options_active:first",Q.$list_multi).index(".combosex_options_"+Q.uid+" a");var an=c("li:first",Q.$list_multi).outerHeight();var ak=c(".combosex_optgroup_label:first",Q.$list_multi).outerHeight();var at=c(".combosex_optgroup_label",Q.$list_multi).size();var aq=an*am+(ak*at)-(Q.$list_multi.height()/2);c(".combosex_options",Q.$list_multi).scrollTop(aq)}}});Q.$combospan.bind("mousedown.combosex",Q.combo_mousedown)}else{if(Q.$obj.attr("data-combosex-headline")){Q.extra.headline=Q.$obj.attr("data-combosex-headline")}if(Q.options.headline){Q.extra.headline=Q.options.headline}var ah=Q.val;var ab=c("option:selected:first",Q.$obj);if(ab.length){ah=ab.text()}Q.$combospan.append('<span class="combosex_input_span"></span>');Q.$dsp=c('<a href="javascript:void(0)" class="combosex_display"></a>').text(ah);c(".combosex_input_span",Q.$combospan).append(Q.$dsp);if(Q.$dsp){Q.$dsp.bind("focus.combosex",Q.combo_dsp_focus);Q.$dsp.bind("blur.combosex",Q.combo_dsp_blur);Q.$dsp.bind("click.combosex",function(){return false});if(Q.extra.headline){Q.$dsp.addClass("combosex_headline").text(Q.extra.headline)}}Q.$arrow=c('<span class="combosex_arrow combosex_arrow_down"><em></em></span>');Q.$combospan.prepend(Q.$arrow);Q.$arrow.outerWidth(Q.scrollWidth);if(!Q.options.classCombo){Y=Y+Q.scrollWidth}Q.$combospan.bind("mousedown.combosex",Q.combo_mousedown)}}Q.$combospan.append(Q.$def,Q.$val);Q.$inp.bind("focus.combosex",Q.combo_focus);Q.$inp.bind("blur.combosex",Q.combo_blur);if(Q.options.tags){Q.$combospan.delegate(".combosex_input","focus.combosex",Q.combo_focus);Q.$combospan.delegate(".combosex_input","blur.combosex",Q.combo_blur);Q.$combospan.delegate(".combosex_tags .combosex_tag_del","click.combosex",function(){var aj=c(this).attr("rel");var ak=c.inArray(aj,Q.val);if(ak>-1){c('option[value="'+aj+'"]',Q.$obj).removeAttr("selected").prop("selected",false)}Q.options_clicking=true;Q.val=Q.$obj.val();Q.tagsRender(Q.val);Q.options_close();Q.options_open();Q.combo_hover=false;r=false;i=false;Q.$inp.trigger("focus.combosex");Q.$obj.trigger("change");Q.tag_actived_id=false;return false})}Q.$combospan.append(Q.$spinner);Q.$combospan.bind("complete.combosex",function(al,aj){if(Q.extra.multiple){var ak=Q.$list_multi}else{var ak=Q.$list}x(Q,ak,aj.results,aj.str)});Q.$combospan.bind("mouseenter.combosex",function(){r=Q.uid;Q.combo_hover=true});Q.$combospan.bind("mouseleave.combosex",function(){r=false;Q.combo_hover=false});Q.combosize.width=Q.$combospan.outerWidth();Q.combosize.height=Q.$combospan.outerHeight();if(Q.extra.type=="select"){if(Q.extra.multiple){ae+=c(".combosex_search",Q.$list_multi).outerHeight()}}p[Q.uid]=Q;Q.$obj.data("combosex",Q);Q.$obj.data("csuid",Q.uid)};Q.tag_active=function(W){};Q.combosize={width:Q.$obj.width()};Q.tagsRender=function(X){if(typeof(X)=="string"){var X=[X]}var Z=function(af,ae){var ad=af;if(ae){ad=ae+"<i>"+af+"</i>"}return"<li><span>"+ad+'</span><a class="combosex_tag_del" rel="'+af+'"><b>&#215;</b></a></li>'};var ab=Z;if(Q.options.tagsRender&&typeof Q.options.tagsRender=="function"){ab=Q.options.tagsRender}var aa="<ul>";for(var Y in X){var W=false;var ac=c('option[value="'+X[Y]+'"]',Q.$obj);if(ac.length){if(X[Y]!=ac.text()){W=ac.text()}}aa+=ab(X[Y],W)}aa+='<li class="combosex_input_span"><span class="combosex_input_hidden"></span></li>';aa+="</ul>";Q.$tags.html(aa);Q.$inp.addClass("combosex_input_tag");c(".combosex_input_span",Q.$tags).append(Q.$inp);if(Q.extra.append){Q.$combospan.append(Q.$apndr)}};Q.suggest={loading:function(){Q.$spinner.show()},loaded:function(){Q.$spinner.fadeOut(333)}};Q.options_open=function(){if(Q.extra.disabled){return false}if(Q.extra.readonly){return false}if(!Q.options_active){i=Q.uid;c(".combosex_main").removeClass("combosex_active");Q.options_active=true;var W=F(Q,Q.data.hash);c(".combosex_poplist:hidden").remove();Q.$list=c('<div class="combosex_poplist combosex_listwrap_'+Q.uid+'"><div class="combosex_options combosex_options_'+Q.uid+'">'+W+"</div></div>");Q.$list.data("csuid",Q.uid);Q.$list.hide();if(Q.extra.input&&Q.extra.type=="select"&&!Q.options.tags){Q.$list.prepend('<div class="combosex_search"><div></div></div><div class="combosex_search_nofound" style="display:none;"><em>'+Q.options.lang.noResults+"</em></div>");Q.$inp.val("");Q.$ph.show();c(".combosex_search div",Q.$list).append(Q.$ph,Q.$inp);if(Q.extra.append&&Q.extra.input){c(".combosex_search div",Q.$list).append(Q.$apndr);Q.$apndr.removeClass("combosex_append_on")}}n.append(Q.$list);if(Q.options.classOptions){Q.$list.addClass(Q.options.classOptions)}Q.lasthoveredoption=c('a[rel="'+Q.val+'"]:first',Q.$list);O(Q);Q.$list.delegate(".combosex_options a","mouseenter.combosexlist"+Q.uid,function(){c(".combosex_options_"+Q.uid+" a").removeClass("combosex_options_hover");Q.lasthoveredoption=c(this);r=Q.uid;Q.options_hover=true;Q.lasthoveredoption.addClass("combosex_options_hover")});Q.$list.delegate(".combosex_options a","mouseleave.combosexlist"+Q.uid,function(){Q.options_hover=false;r=false;if(Q.lasthoveredoption){Q.lasthoveredoption.addClass("combosex_options_hover")}});Q.$list.bind("mouseenter.combosexlist"+Q.uid,function(){Q.options_hover=true;r=Q.uid});Q.$list.bind("mousedown.combosexlist"+Q.uid,function(X){X.stopPropagation()});Q.$list.bind("mouseleave.combosexlist"+Q.uid,function(X){Q.options_hover=false;r=false});Q.$list.delegate(".combosex_options a","click.combosexlist"+Q.uid,function(){Q.option_select(c(this))});Q.$list.bind("click",function(){});Q.options_hide();if(Q.extra.type=="input"&&(Q.$inp.val()!=""||Q.options.showOnFocus)){L(Q.$inp,Q)}if(Q.extra.type=="select"){Q.options_show()}if(Q.lasthoveredoption){}Q.$combospan.addClass("combosex_active")}};Q.options_close=function(){if(Q.options_active){i=false;Q.$combospan.removeClass("combosex_active");Q.options_hover=false;Q.options_hide();Q.$list.remove()}};Q.options_show=function(){var Z=Q.$combospan.offset();var Y=c('a[rel="'+Q.val+'"]:first',Q.$list);var W=0;i=Q.uid;if(!Q.options_visible&&Q.$list&&Q.$list.find("li").size()>0){Q.$list.css({left:Z.left+"px"}).show();if(Y.length){Q.lasthoveredoption=Y;var X=Y.parent().position();var W=X.top-(Q.$list.height()/2);Y.addClass("combosex_options_hover")}c(".combosex_options_"+Q.uid).scrollTop(W);Q.$list.fadeIn(Q.options.fadeSpeed,function(){i=Q.uid;Q.options_visible=true;Q.options_active=true;i=Q.uid;setTimeout(function(){c(".combosex_input:first",Q.$list).trigger("focus");Q.$combospan.addClass("combosex_active")},1)});Q.options_active=true;Q.options_visible=true}};Q.options_hide=function(X){var W=Q.options.fadeSpeed;if(X){W=X}if(Q.options_visible){Q.$list.fadeOut(W,function(){Q.options_active=false;Q.options_visible=false})}};Q.combo_focus=function(){c(".combosex_main").removeClass("combosex_active");if(Q.extra.disabled){return false}if(Q.extra.readonly){return false}Q.$combospan.addClass("combosex_active");if(o){if(o&&r!=o&&p[o]){if(p[o].multi_focus){p[o].$list_multi.triggerHandler("blur.combosex")}}}if(Q.extra.type=="select"){if(d&&d!=g){c(".combosex_input",p[d].$combospan).trigger("blur.combosex")}if(Q.extra.multiple){g=Q.uid;o=Q.uid;Q.$combospan.addClass("combosex_active")}}if(Q.extra.type=="input"||Q.options.tags){g=false;d=Q.uid;Q.options_open()}};Q.combo_blur=function(){if(Q.$list_multi){if(Q.extra.type=="select"&&Q.extra.multiple){if(Q.uid!=g||r!=Q.uid&&Q.multi_focus){Q.$list_multi.triggerHandler("blur.combosex");g=false;if(Q.$apndr){Q.$apndr.removeClass("combosex_append_on")}}}}if(Q.extra.type=="input"){var W=Q.$inp.val();if(d==i&&Q.options_active){r=false}if(!Q.options_active&&!Q.options.tags&&d==Q.uid&&i==Q.uid){Q.options_active=true;Q.options_close();Q.options_active=false}if(d==Q.uid&&!i&&!Q.options.tags){if(!Q.options.append){var X=w(Q.data.hash,W.toLowerCase());if(!X&&!Q.extra.append){Q.val="";Q.$val.val("");Q.$inp.val("");Q.$obj.val("")}}Q.$obj.triggerHandler("change");if(d){d=false}}if(Q.options.tags){Q.$inp.val("");if(d==i&&!Q.options_active){Q.options_active=true;Q.options_close();Q.options_active=false}}Q.$obj.triggerHandler("blur")}d=false};Q.combo_dsp_focus=function(){j=Q.uid;c(".combosex_main").removeClass("combosex_active");if(Q.extra.disabled){return false}if(Q.extra.readonly){return false}Q.$combospan.addClass("combosex_active")};Q.combo_dsp_blur=function(){c(".combosex_main").removeClass("combosex_active");Q.$combospan.removeClass("combosex_active");j=false};Q.combo_mousedown=function(W){if(Q.extra.disabled){return false}if(Q.extra.readonly){return false}if(Q.extra.type=="select"){if(Q.extra.multiple){c(".combosex_main").removeClass("combosex_active");Q.$combospan.addClass("combosex_active");Q.$inp.trigger("focus.combosex")}else{if(!Q.options_active){Q.options_open()}else{Q.options_close()}}}if(Q.extra.type=="input"){}};Q.change_multi_values=function(){var W=[];c("option",Q.$obj).removeAttr("selected").prop("selected",false);c(".combosex_options_"+Q.uid+" .combosex_options_active").each(function(Z,aa){var X=c(aa).attr("rel");W.push(X);var Y=c('option[value="'+X+'"]',Q.$obj);if(!Y.length){Y=c('<option selected="selected" value="'+X+'">'+X+"</option>");Q.$obj.append(Y)}if(Y){Y.attr("selected","selected").prop("selected",true)}Q.data={hash:J(Q.$obj)}});Q.val=W;Q.$obj.val(W).triggerHandler("change")};Q.option_select=function(X){if(!X.length||!X){return false}if(X.hasClass("combosex_options_disabled")){return}if(Q.options.tags){if(X){var W=X.attr("rel");if(!Q.val){Q.val=[]}if(c.inArray(W,Q.val)<0){Q.val.push(W);if(!c('option[value="'+W+'"]',Q.$obj).length){Q.$obj.append('<option value="'+W+'" selected="selected">'+c("span",X).text()+"</option>")}else{c('option[value="'+W+'"]',Q.$obj).text(c("span",X).text())}Q.tagsRender(Q.val);Q.$obj.val(Q.val);Q.$obj.triggerHandler("change");r=false}Q.$inp.trigger("focus.combosex");Q.$val.val(Q.val);Q.$inp.val("");c(".combosex_options",Q.$list).html(F(Q,Q.data.hash));c(".combosex_append_on",Q.$combospan).removeClass("combosex_append_on");Q.lasthoveredoption=false}if(!Q.options.optionsNoHide){Q.options_hide()}}if(Q.extra.type=="select"){if(Q.extra.multiple){}else{if(Q.options_active){if(X){var Y=X.attr("rel");Q.API.val.apply(Q,[Y]);Q.$obj.trigger("change");Q.combo_hold_reopen=false;Q.options_clicking=true;Q.options_close();Q.$dsp.trigger("focus.combosex");if(Q.extra.headline){Q.$dsp.text(Q.extra.headline)}}}}}if(Q.extra.type=="input"&&!Q.options.tags){if(Q.options_active){if(X){Q.val=X.attr("rel");if(Q.$ph){Q.$ph.hide()}Q.$val.val(Q.val);Q.$inp.val(c("span",X).text());Q.$obj.val(Q.val);Q.$obj.triggerHandler("change");Q.combo_hold_reopen=false;Q.options_clicking=true;Q.$inp.trigger("focus.combosex");Q.options_hide()}}}if(Q.options.onSelect&&typeof Q.options.onSelect=="function"){Q.options.onSelect(Q)}O(Q)};Q.attach();Q.API={reinit:function(W){},val:function(Y){if(Q.extra.type=="select"){if(Q.extra.multiple){}else{Q.val=Y;var W=C(Q.data.hash,Y);if(Q.extra.append&&!W){var X=c('<option value="'+Y+'">'+Y+"</option>");c(Q.$obj).append(X);W={val:Y,text:Y}}if(W){this.dspval=W.text;Q.$val.val(Y);Q.$dsp.text(this.dspval);Q.$obj.val(Y)}}}if(Q.extra.type=="input"&&!Q.options.tags){Q.val=Y;Q.$val.val(Y);Q.$obj.val(Y)}if(Q.options.tags){}},optionsDisable:function(X){if(!c.isArray(X)){X=[X]}for(var W in Q.data.hash){if(c.inArray(Q.data.hash[W].val,X)>-1){Q.data.hash[W].disabled=true}}for(var W in X){c('option[value="'+X[W]+'"]',Q.$obj).prop("disabled",true)}},optionsEnable:function(X){if(!c.isArray(X)){X=[X]}for(var W in Q.data.hash){if(c.inArray(Q.data.hash[W].val,X)>-1){Q.data.hash[W].disabled=false}}for(var W in X){c('option[value="'+X[W]+'"]',Q.$obj).prop("disabled",false)}}};return p[Q.uid]};var E=function(R,S){var Q="<ul>";var P=function(T){c.map(T,function(V){if(V){if(V.group){Q+='<li class="combosex_optgroup"><span class="combosex_optgroup_label"><span>'+V.text+"</span></span><ul>";P(V.group);Q+="</ul></li>"}else{var W=" ";if(V.selected){W=" combosex_options_active"}var U=" ";if(V.disabled){U=" combosex_options_disabled"}if(!V.text){V.text="&nbsp;"}Q+='<li><a class="'+W+U+'" rel="'+V.val+'"><span>'+V.text+"</span></a></li>"}}})};if(R){P(R)}Q+="</ul>";return Q};var F=function(Q,P){if(Q.options.tags){if(Q.val&&P){var P=c.grep(P,function(T){if(c.inArray(T.val,Q.val)>-1){return false}else{return T}})}}if(Q.options.render){var S=Q.options.render}else{var S=E}var R=S(P,Q);Q.lasthoveredoption=false;if(R){return R}else{return""}};var J=function(Q){var P=[];var R=function(S){c.map(S,function(W){if(c(W).prop("tagName").toLowerCase()=="optgroup"){var V=[];c.map(c("> *",W),function(X){V.push({val:c(X).attr("value"),text:c(X).text(),selected:true?c(X).prop("selected"):false,disabled:true?c(X).prop("disabled"):false})});P.push({text:c(W).attr("label"),group:V})}else{if(c(W).prop("tagName").toLowerCase()=="option"){var T=c(W).attr("value");var U=c(W).text();if(!T){T=U}else{if(!U){U=T}}P.push({val:T,text:U,selected:true?c(W).prop("selected"):false,disabled:true?c(W).prop("disabled"):false})}}})};R(c("> *",Q));return P};var y=function(R){var P=[];if(c.isArray(R)){for(var Q in R){P.push({val:R[Q],text:R[Q]})}}else{for(var Q in R){P.push({val:Q,text:R[Q]})}}return P};var O=function(V){if(V.extra.multiple){return false}var W=V.$combospan.offset();var R=V.$list.height();if(t.browser.msie&&t.browser.version=="6.0"){var Q=300;if(V.options.optionsHeight){Q=V.options.optionsHeight}if(V.$list.height()>Q){V.$list.height(Q)}R=Q}var T=W.top-f.scrollTop();var P=f.scrollTop()+f.height()-W.top;var S=0;if(P>=T||R<P){S=W.top+V.$combospan.outerHeight();V.$list.removeClass("combosex_options_dropup")}else{S=W.top-R;V.$list.addClass("combosex_options_dropup")}V.$list.width("auto");var U=V.$list.width();if(U<=V.$combospan.width()){U=V.$combospan.width()}else{}V.$list.css({top:S,width:U})};var G=function(Q){l=true;if(o){if(o&&r!=o&&p[o]){p[o].$list_multi.triggerHandler("blur.combosex")}}for(var P in p){if(r!=P){if(p[P].options_active&&!p[P].combo_hover){p[P].options_close();p[P].options_active=false}p[P].$combospan.removeClass("combosex_active")}}};var u=function(P){l=false};var D=function(Q){var S=false,U=false,T=false;var R=false;if(Q.target){S=c(Q.target);var P=S.parents(".combosex_poplist");R=P.data("csuid")}if(g&&g!=i){i=false}if(i||g){if(p[i]||p[g]){if(i){g=false}if(p[i]){U=p[i];T=p[i].$list;if(U.extra.type=="input"){S=U.$inp}}if(p[g]){U=p[g];T=p[g].$list_multi}}}if(!i&&!g){if(R){if(p[R]){U=p[R];if(U.extra.type=="select"&&U.extra.multiple){T=p[R].$list_multi}else{i=R;T=p[R].$list}}}else{if(d){if(p[d]){U=p[d];if(U.options.tags){T=U.$list}}}}}B(function(V){if(S&&U&&T){L(S,U,T)}},U.options.delay)(Q)};var s=function(Q,R){var P=c.map(Q,function(U,T){if(U.group){var S={text:U.text,group:c.map(U.group,function(V){if(!V.val.toLowerCase().indexOf(R.str)||!V.text.toLowerCase().indexOf(R.str)){return V}})};if(S.group.length){return S}}else{if(U.val){U.val=U.val.toString();U.text=U.text.toString();if(!U.val.toLowerCase().indexOf(R.str)||!U.text.toLowerCase().indexOf(R.str)){return U}}}});R.results(P)};var C=function(R,S){var Q=false;S=S.toLowerCase();var P=c.map(R,function(V,U){if(V.group){var T={text:V.text,group:c.map(V.group,function(Y){if(Y.val.toLowerCase()==S||Y.text.toLowerCase()==S){return Y}})};if(T.group.length){return T}}else{if(V){if(typeof V.val=="string"){var X=V.val.toLowerCase()}else{var X=V.val}if(typeof V.text=="string"){var W=V.text.toLowerCase()}else{var W=V.val}if(X==S||W==S){Q=V;return V}}}});return Q};var w=function(Q,R){var P=[];if(Q){P=c.map(Q,function(U,T){if(U.group){var S={text:U.text,group:c.map(U.group,function(X){if(X.val.toLowerCase()==R||X.text.toLowerCase()==R){return X}})};if(S.group.length){return S}}else{if(U.val){if(typeof U.val=="string"){var W=U.val.toLowerCase()}else{var W=U.val}if(typeof U.text=="string"){var V=U.text.toLowerCase()}else{var V=U.val}if(U.val==R||U.text==R){return U}}}})}if(P.length){return P}else{return false}};var z=function(R){var P=R.data.hash;var Q={value:R.val,results:function(S){R.suggest.loaded();R.$combospan.trigger("complete.combosex",{results:S,str:R.searchString})}};return{go:function(T){var S=false;R.searchString=T;R.suggest.loading();Q.str=T;if(R.options.suggest){S=R.options.suggest(P,Q)}else{S=s(P,Q)}if(S){return S}else{return[]}}}};var x=function(U,S,R,T){var Q=w(R,T);if(U.extra.append&&U.$apndr){U.$apndr.removeClass("combosex_append_on")}if(!Q&&U.extra.append&&U.$apndr){U.$apndr.addClass("combosex_append_on")}var P=c(".combosex_search_nofound",S);c(".combosex_options",S).html(F(U,R));O(U);if(U.extra.type=="select"){c(".combosex_search_nofound",S).hide();if(!R.length){c(".combosex_search_nofound",S).show()}}if(!U.extra.multiple){if(U.extra.type=="input"){if(R&&R.length>0){U.options_show()}else{U.options_hide()}}if(R&&c(".combosex_options a:visible",S).length){c(".combosex_options a",S).removeClass("combosex_options_hover");U.lasthoveredoption=c(".combosex_options a:visible:first",S);U.lasthoveredoption.addClass("combosex_options_hover")}}};var L=function(R,T){var Q=false;if(T.extra.append&&T.$apndr){T.$apndr.removeClass("combosex_append_on")}if(R&&R.val()!=undefined){var S=R.val().toLowerCase().toString();var P=c(".combosex_listwrap_"+T.uid+" .combosex_search_nofound");if(S||S==""){new z(T).go(S)}else{if(T.options.showOnFocus&&!T.extra.multiple){T.options_show()}c(".combosex_listwrap_"+T.uid+" .combosex_search_nofound").hide();c(".combosex_options_"+T.uid).html(F(T,T.data.hash))}}else{c(".combosex_options_"+T.uid).html(F(T,T.data.hash))}};var A=function(R){var Q=0;if(document.selection){R.focus();var P=document.selection.createRange();P.moveStart("character",-R.value.length);Q=P.text.length}else{if(R.selectionStart||R.selectionStart=="0"){Q=R.selectionStart}}return(Q)};var H=function(Q,R){if(Q.setSelectionRange){Q.focus();Q.setSelectionRange(R,R)}else{if(Q.createTextRange){var P=Q.createTextRange();P.collapse(true);P.moveEnd("character",R);P.moveStart("character",R);P.select()}}};var N=function(V){if(V.which==8){if(d){if(p[d]){var R=p[d];if(R.options.tags){if(A(V.srcElement)<1){R.tag_active(R.$tags.find('li:not(".combosex_input_span"):last'))}}}}}if(V.which==38||V.which==40){if(i&&d&&d==i){if(p[i]){if(!p[i].options_active){p[i].options_open()}}}if(i){if(p[i]){if(p[i].options_active){var Y=-1;if(V.which==40){Y=1}a=true;var ac=c(".combosex_options_"+i+" a:visible").length;var S=c(".combosex_options_"+i+" .combosex_optgroup_label:first").outerHeight();var X=c(".combosex_options_"+i+" .combosex_optgroup_label").length;var T=-1;if(p[i].lasthoveredoption){T=p[i].lasthoveredoption.index(".combosex_options_"+i+" a:visible")}var ab=T+Y;if(ab<0){ab=ac-1}if(ab>ac-1){ab=0}p[i].lasthoveredoption=c(".combosex_options_"+i+" a:visible").eq(ab);c(".combosex_options_"+i+" a").removeClass("combosex_options_hover");p[i].lasthoveredoption.addClass("combosex_options_hover");var U=(p[i].lasthoveredoption.outerHeight()*ab)+(S*X)-p[i].$list.height()/2;c(".combosex_options_"+i).scrollTop(U);V.preventDefault();return false}}}if(g||r){if(g&&r!=g){var R=p[g]}if(r&&g&&r==g){var R=p[r]}if(R&&R.extra.type=="select"){a=true;var ac=c(".combosex_options_"+g+" a:visible").length;var S=c(".combosex_options_"+g+" .combosex_optgroup_label:first").outerHeight();var X=c(".combosex_options_"+g+" .combosex_optgroup_label").length;var Y=-1;if(V.which==40){Y=1}if(h){if(R.startshift){var T=-1;if(R.lastoptionclicked){T=R.lastoptionclicked.index(".combosex_options_"+g+" a:visible")}var ab=T+Y;if(ab<0){ab=0}if(ab>ac-1){ab=ac-1}R.lastoptionclicked=c(".combosex_options_"+g+" a:visible").eq(ab);R.lastoptionclicked.addClass("combosex_options_active");var Q=R.lastoptionclicked;c(".combosex_options_"+g+" a").removeClass("combosex_options_active");var P=R.startshift.index(".combosex_options_"+g+" a:visible");var W=Q.index(".combosex_options_"+g+" a:visible");var aa=P;var Z=W;if(P>W){aa=W;Z=P}c(".combosex_options_"+g+" a:visible").slice(aa,Z).addClass("combosex_options_active");Q.addClass("combosex_options_active");R.startshift.addClass("combosex_options_active");var U=(Q.outerHeight()*ab)+(S*X)-R.$list_multi.height()/2;c(".combosex_options",R.$list_multi).scrollTop(U)}}else{var T=-1;if(R.lastoptionclicked){T=R.lastoptionclicked.index(".combosex_options_"+g+" a:visible")}var ab=T+Y;if(ab<0){ab=ac-1}if(ab>ac-1){ab=0}R.lastoptionclicked=c(".combosex_options_"+g+" a:visible").eq(ab);c(".combosex_options_"+g+" a").removeClass("combosex_options_active");R.lastoptionclicked.addClass("combosex_options_active");var U=(R.lastoptionclicked.outerHeight()*ab)+(S*X)-R.$list_multi.height()/2;c(".combosex_options_"+g).scrollTop(U);R.startshift=R.lastoptionclicked}if(c(".combosex_options_"+g+" .combosex_options_active").length){R.change_multi_values()}V.preventDefault();return false}}}if(V.which==13){a=true;if(i){if(p[i]){var R=p[i];if(R.lasthoveredoption){R.option_select(R.lasthoveredoption);R.lasthoveredoption=false;return false}else{if(R.extra.append&&!R.extra.tags){R.API.val.apply(R,[R.$inp.val()]);R.options_close();R.$dsp.trigger("focus.combosex")}}if(R.extra.tags){K(R,R.$inp.val());return false}}}if(g){if(p[g]){var R=p[g];K(R,R.$inp.val());return false}}}if(V.which==16){h=true}if(V.which==17){e=true}if(V.which==16||V.which==17){a=true;if(g){if(l){document.ondragstart=function(){return false};document.body.onselectstart=function(){return false}}}}if(V.which==32){if(j){if(p[j]){var R=p[j];if(!R.options_active){R.options_open();return false}}}if(i){}}if(V.which==9){a=true;if(i){if(p[i]){if(p[i].options_active){p[i].options_close()}}}if(g){if(p[g]){if(p[g].extra.multiple){p[g].$list_multi.triggerHandler("blur.combosex");g=false}}}if(d){if(p[d]){}}}};var M=function(P){if(P.which==16){h=false}if(P.which==17){e=false}if(P.which==16||P.which==17){document.ondragstart=null;document.body.onselectstart=null}};var K=function(R,Q){if(R&&Q&&Q!=""){var P=!w(R.data.hash,Q);if(P){P={val:Q,text:Q}}if(R.options.appendCheck){P=R.options.appendCheck(R.data.hash,Q)}if(P&&R.extra.append){P.selected=true;R.data.hash.push(P);R.$apndr.removeClass("combosex_append_on");if(R.extra.type=="select"){if(R.extra.multiple){R.$inp.val("");c(".combosex_search_nofound",R.$list_multi).hide();c(".combosex_options_"+R.uid).html(F(R,R.data.hash));R.change_multi_values()}else{c(".combosex_options_"+R.uid).html(F(R,[P]));R.option_select(c(".combosex_options_"+R.uid+' a[rel="'+Q+'"]'));return false}}if(R.extra.type=="input"){c(".combosex_options_"+R.uid).html(F(R,[P]));R.option_select(c(".combosex_options_"+R.uid+' a[rel="'+Q+'"]'));return false}}}};m.delegate(".combosex_append_on","mouseenter.combosex mousedown.combosex",function(P){P.stopPropagation();r=Number(c(this).attr("rel"));return false});m.delegate(".combosex_append_on","click.combosex",function(R){var P=Number(c(this).attr("rel"));r=P;if(P&&p[P]){var S=p[P];var Q=S.$inp.val();K(S,Q)}R.preventDefault()});m.unbind("keydown.combosex");m.bind("mousedown.combosex",G);m.bind("mouseup.combosex",u);m.delegate(".combosex_input","keyup.combosex",function(Q){var P=c(this);M(Q);if(h){a=true}if(a){a=false;return false}return D(Q)});m.bind("keydown.combosex",N);m.bind("keyup.combosex",M);m.delegate(".combosex_input","keydown.combosex keyup.combosex change.combosex",function(){var S=c(this);var W=S.val();var U=S.parent().find(".combosex_ph");if(U.length>0){if(W&&W!=""){U.hide()}else{U.show()}}if(d){if(p[d]){var V=p[d];if(V.extra.type=="input"){if(V.options.tags){if(S.hasClass("combosex_input_tag")){var Q=S.parent();var R=c(".combosex_input_hidden",Q);R.text(S.val());var T=R.outerWidth();if(T<30){T=30}var P=S.parents(".combosex_main").innerWidth()-30;if(T>P){T=P}Q.width(T)}}O(V)}}}});m.delegate(".combosex_search, .combosex_text, .combosex_tagged","click",function(P){c(this).find(".combosex_input").trigger("focus.combosex");P.stopPropagation()});return this.each(function(P,Q){new Combosex(c(Q),v,t.args)})};var r=false,i=false,k=0,h=false,e=false,g=false,j=false,d=false,l=false,p={},o=false,b=false,q=333,a=false,m=c(document),f=c(window),n=c("body")})(jQuery);